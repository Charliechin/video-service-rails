<!DOCTYPE html><html><head><title>Video Customer Service</title><style>body, html {
  height:100%;
  width:100%;
  padding:0;
  margin:0;
  overflow:hidden;
  background-color:#ddd;
}
.wrapper {
  height:100%;
  width:100%;
}</style><link rel="shortcut icon" href="//twilio.com/bundles/marketing/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="//twilio.com/bundles/marketing/img/favicons/favicon_57.png"><link rel="apple-touch-icon" sizes="72x72" href="//twilio.com/bundles/marketing/img/favicons/favicon_72.png"><link rel="apple-touch-icon" sizes="114x114" href="//twilio.com/bundles/marketing/img/favicons/favicon_114.png"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css"><link rel="stylesheet" href="viewsaurus.css"></head><body><div class="wrapper"><div id="viewsaurus" data-title="Video Customer Service"><div class="saurus-panes"><div class="saurus-prose"><div class="saurus-prose-header"><div class="title-outer"><span class="step-title">Video Customer Service</span></div></div><div class="saurus-nav-buttons"><div class="saurus-nav-button nav-overview"><div class="saurus-nav-button-inner"><i class="fa fa-fw fa-list"></i></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-previous"><div class="saurus-nav-button-inner"><a href=""> <i class="fa fa-fw fa-play fa-rotate-180"></i></a></div><div class="nav-divider"></div></div><div class="saurus-nav-button nav-next clickable"><div class="saurus-nav-button-inner"><a href="#1"> <i class="fa fa-fw fa-play"></i></a></div></div><div class="saurus-next-title"><span class="next-title-inner"></span></div></div><div class="saurus-progress-bar"></div><div class="saurus-start"><p>Video Customer Support enables your support agents to easily connect with your customers using live video. Learn how to implement it in minutes.</p><a href="#0">Start Tutorial</a></div><div class="saurus-content"><div data-title="Customer Support" class="chapter"><div data-title="Introduction" class="step"><h2 id="how-it-works">How It Works</h2>
<p>Ready to implement video customer support? Here&#39;s how it works at a high level:</p>
<ol>
<li>A user visits a product page and requests support</li>
<li>An agent at her terminal initiates a video call with the customer</li>
<li>The user accepts the incoming call and is immediately connected to a live agent in the browser.</li>
</ol>
<h2 id="building-blocks">Building Blocks</h2>
<p>Here are the technologies we&#39;ll use to get this done:</p>
<ul>
<li><a href="http://rubyonrails.org/">Ruby on Rails</a> to create a database-driven web application</li>
<li><a href="/video/request-early-access">Twilio Video SDK</a> (limited beta) a javascript library for real-time video</li>
<li><a href="/docs/api/rest/token">Twilio Tokens</a> from Twilio&#39;s REST API to generate a capability token</li>
</ul>
<h2 id="how-to-read-this-tutorial">How To Read This Tutorial</h2>
<p>To implement video customer support, we will be working through a series of <a href="http://en.wikipedia.org/wiki/User_story">user stories</a> that describe how to fully implement video support in a web application. We&#39;ll walk through the code required to satisfy each story, and explore what we needed to add at each step.</p>
<p>Let&#39;s get started! Click the right arrow to move on to the next step of the tutorial.</p>
</div><div data-title="The User Story" class="step"><h2>Customer Support</h2><blockquote> 
As a user, I want to click a button on a product page to request live video support.</blockquote><p>This story requires that we create a bit of UI and a model object to create and save a new <code>SupportTicket</code> in our system. At a high level, here&#39;s what we will need to add:</p>
<ul>
<li>A button to initiate the support interaction</li>
<li>A route and controller function on the server that will create a support ticket for the user.</li>
<li>Some javascript that will make an ajax call to our <code>support/create</code> route.</li>
<li>A persistent <code>SupportTicket</code> model object to store information about the support request</li>
</ul>
<p>Let&#39;s start by looking at the model, where we decide what information we want to store with the ticket.</p>
</div><div data-title="Creating a SupportTicket" data-file="db/schema.rb" class="step"><h2 id="creating-a-support-ticket">Creating a Support Ticket</h2>
<p>We begin by generating an <a href="http://guides.rubyonrails.org/active_record_basics.html">Active Record</a> model that we will store in a postgres database. For our purposes we don&#39;t need to store very much information about the support ticket - just some information about where to call the customer (we&#39;ll talk about <code>Endpoints</code> soon) and some context about where they are calling from.</p>
<p>We&#39;ll use the <a href="http://guides.rubyonrails.org/command_line.html#rails-generate">Rails generate command</a> to create our model:
<code>bin/rails generate model SupportTicket endpoint:string product_id:string</code></p>
<p>This generator creates our model, migration and schema for us. Now all we need to run is <code>rake db:migrate</code> and we have a table of SupportTickets.</p>
<p>Now that we have a model object to save a ticket, let&#39;s move up to the controller level to see how we create one.</p>
</div><div data-title="Creating a Route" data-file="config/routes.rb" class="step"><h2 id="creating-our-route">Creating our Route</h2>
<p>In Rails we often generate our routes, but this time we&#39;ll define the few we have by hand. Notice our support routes, which all point to controller functions. In this case we will call support/create in javascript.</p>
<p>We will find the <code>create</code> method in our <code>SupportController</code>.</p>
</div><div data-title="The Support Controller" data-file="app/controllers/support_controller.rb" data-highlight="" class="step"><h2 id="the-support-controller">The Support Controller</h2>
<p>This controller is responsible for handling all of the interactions we&#39;ll want to make with our Support Ticket system. </p>
<p>This should feel pretty similar to a Rails-generated controller, in fact it is very similar. However, since we know what method these routes will always be called, and in what format (javascript) we can simply return headers instead of templates.</p>
<p>Before we move on to discuss how Video works, let&#39;s peek at the javascript that creates the support ticket. </p>
</div><div data-title="Creating a Support Ticket" data-file="app/assets/javascripts/app.js" data-highlight="33-43" class="step"><h2 id="creating-a-support-ticket">Creating a Support Ticket</h2>
<p>So far we have created a route <code>/support/create</code> which points to the <code>create</code> function inside of the SupportController. Now let&#39;s tie it all together.</p>
<p>Some of this code may look unfamiliar to you, specifically <code>createEndpoint()</code> but rest assured you will have a wealth of knowledge around Endpoints when we&#39;re done-- for now you just need to know that it is at this point that we create an Endpoint for the user.</p>
<p>Inside the <a href="//api.jquery.com/deferred.done/">.done()</a> callback we simply make an ajax POST request to &#39;/support/create&#39; with the page url as context, and an address that we can reach the user at later in our video call.</p>
<p>Once the SupportTicket is created an agent will see it at <code>/support/list</code> which is a list of open support tickets. From here the agent will be able to click a button and initiate a video call.</p>
<p>Awesome, it&#39;s probably time to talk about these Endpoints and how to make a Twilio Video call.</p>
</div></div><div data-title="The Video Call" class="chapter"><div data-title="Starting a Video Call" data-file="app/assets/javascripts/app.js" class="step"><h2>Starting a video support call</h2><blockquote> 
As an agent, I would like to click on a support request to initiate a video conversation with the user.</blockquote><p>Time to get to the meat of this use-case. In this section we will build the largest chunk of the functionality, in which a Customer Support agent can initiate a vide call with a specific User chosen from a list of open support tickets. </p>
<p>To do this we need to implement:</p>
<ul>
<li>Creating a Capability Token</li>
<li>An Endpoint for the user</li>
<li>An Endpoint for the agent</li>
<li>A Conversation between the two parties</li>
</ul>
<p>Let&#39;s start by looking at the first piece of the connection, the Capability Token.</p>
</div><div data-title="Generating a Capability Token" data-file="app/controllers/concerns/generate_token.rb" class="step"><h2 id="generating-a-capability-token">Generating a Capability Token</h2>
<p>Capability tokens allow you to add Twilio capabilities to web and mobile applications without exposing your AuthToken in JavaScript or any other client-side environment.</p>
<p>Generating one using the twilio-ruby library is actually pretty simple. For now, while the Video SDK is in beta, we can fake the <code>client_outgoing</code> Account SID, but the <code>client_incoming</code> method needs to be passed an Endpoint Address, which can be any string (example: it could be &#39;customer&#39; or &#39;agent&#39;).</p>
<pre class="note">One last note about this code is that we need to access it from multiple controllers and on multiple pages, therefore we are putting inside of a Rails [Concern](//api.rubyonrails.org/classes/ActiveSupport/Concern.html) which allows for code to be easily shared across files.</pre><p>Now let's finally talk about Endpoints.</p></div><div data-title="Creating an Endpoint" data-file="app/assets/javascripts/app.js" data-highlight="1-30" class="step"><h2 id="creating-and-endpoint">Creating and Endpoint</h2>
<p>What is an Endpoint? Well simply put an Endpoint is one side of a Conversation. It is identified by an address (string) and once it&#39;s created it gives us control over the Conversation and therefore the entre Video call.</p>
<p>In this use-case we will need to create an Endpoint for both the agent and the user. </p>
<ul>
<li>Create user endpoint: we did this earlier, when the user requested support.</li>
<li>Create agent endpoint: we&#39;ll do this next when the Agent initiates a call.</li>
</ul>
<p>To create an Endpoint we first need to pass it our capability token. In this case our token is being passed to the front-end by our controller. Let&#39;s take a quick detour to look at the front-end.</p>
</div><div data-title="The Application Layout" data-file="app/views/layouts/application.html.erb" data-highlight="52-68" class="step"><h2 id="the-application-layout">The Application Layout</h2>
<p>Our layout, which all other pages render inside of, contains most of the elements for our Video call. </p>
<h3 id="video-tags">Video Tags</h3>
<p>In order to display our media streams, we need to make sure that for each video stream we supply the front-end with a <code>video</code> element. In this case we have two video tags &#39;#local-video&#39; and &#39;#remote-video&#39;.</p>
<h3 id="capability-token-javascript-object">Capability Token javascript object</h3>
<p>In order to instatiate our Endpoint we pass the server-generated capability token to the front-end. </p>
<p>Okay, now that we have our markup, our token and our Endpoint, let&#39;s create a Conversation.</p>
</div><div data-title="Starting a Conversation" data-file="app/assets/javascripts/app.js" data-highlight="120-125" class="step"><h2 id="starting-a-conversation">Starting a Conversation</h2>
<p>At this point our agent is ready to initiate a call which means we need one very important piece of information, the user&#39;s Endpoint address. </p>
<p>Luckily, we stored this address in the support ticket, so all we need to do is grab it from the UI. One easy way to store this information is to simply assign a data attribute to it:</p>
<pre><code>  &lt;a class=&#39;connect-call btn-block btn btn-success&#39; data-endpoint=&quot;&lt;%= ticket.endpoint %&gt;&quot;
      data-ticket=&quot;&lt;%= ticket.id %&gt;&quot; href=&quot;#&quot; &gt;Call customer&lt;/a&gt;
</code></pre><p>We&#39;ll also store the <code>ticket.id</code> so that we can delete the support ticket once our call is connected.</p>
<p>Now let&#39;s slide up to the function that will call our customer, using our newly acquired address.</p>
</div><div data-title="Calling the Customer" data-file="app/assets/javascripts/app.js" data-highlight="81-100" class="step"><h2 id="calling-the-customer">Calling the Customer</h2>
<p>In order to open a two-way connection with the user, our agent device needs to call <code>myEndpoint.createConversation()</code> and pass it the address for the customer&#39;s Endpoint. </p>
<p>This is one major benefit of using the Twilio Video SDK, instead of handling the registration and setup yourself, you can simply call <code>createConversation()</code>.</p>
<p>As soon as this completes we need to inject the video Streams on to the page. </p>
<p>Lastly we&#39;ll call a function that will delete the support ticket, but before we move on to that we need to talk about video Streams.</p>
</div><div data-title="Video Streams" data-file="app/assets/javascripts/app.js" data-highlight="59-76" class="step"><h2 id="showing-the-video-streams">Showing the Video Streams</h2>
<p>A Stream is a wrapper for the MediaStream object and provides us with a high-level API for muting, pausing and attaching to the DOM. </p>
<p>In this function what we are doing is attaching our Streams to the video elements we created to display the video.</p>
<p>Before we can attach the remote video we need to make sure that the remote participant has joined, which we can do by listening for the <code>participantJoined</code> event on the Conversation.</p>
<p>At this point we have two live video streams on the page! The last piece is controlling the video and ending the call. </p>
</div><div data-title="Video Controls" data-file="app/assets/javascripts/app.js" data-highlight="99-109" class="step"><h2 id="video-controls">Video Controls</h2>
<p>The final piece is to create controls for the video. The only two we care about here are muting the local <code>Stream</code> and ending the call. You can see here both are simple one-line commands.</p>
<p>As simple as this bit is, it is what we&#39;re most excited about here at Twilio. The ability to make a simple API call on an active Conversation opens up the world of IP-based communications.</p>
<p>Earlier we saved the global <code>supportConversation</code> object which houses our conversation. This gives us a handle into all of the Twilio API. As of this writing all we can do is mute, pause and leave the conversation, but it&#39;s not hard to imagine being able to share the screen, record the conversation (video and audio), or even transfer the call to your phone. </p>
</div><div data-title="All Done" data-file="app/assets/javascripts/app.js" class="step"><h2 id="all-done">All Done</h2>
<p>Wow, that was quite an undertaking, but in reality we had to write very little code to get a real-time video call implemented into our support app.</p>
<p>We&#39;d also love to hear your feedback on this tutorial - <a href="mailto:help@twilio.com">please reach out to us</a> with any questions you might have.  Thanks for checking out the tutorial!</p>
<hr/><h2>Deploy This App</h2><p></p><a href="https://heroku.com/deploy?template=https://github.com/TwilioDevEd/video-service-rails"><img src="//camo.githubusercontent.com/c0824806f5221ebb7d25e559568582dd39dd1170/68747470733a2f2f7777772e6865726f6b7563646e2e636f6d2f6465706c6f792f627574746f6e2e706e67" alt="Deploy" data-canonical-src="https://www.herokucdn.com/deploy/button.png" style="max-width:100%;"/></a></div></div>
<div class="saurus-files" style="display:none;"><textarea class="saurus-file" data-file="db/schema.rb" data-mode="ruby">IyBlbmNvZGluZzogVVRGLTgKIyBUaGlzIGZpbGUgaXMgYXV0by1nZW5lcmF0ZWQgZnJvbSB0aGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgZGF0YWJhc2UuIEluc3RlYWQKIyBvZiBlZGl0aW5nIHRoaXMgZmlsZSwgcGxlYXNlIHVzZSB0aGUgbWlncmF0aW9ucyBmZWF0dXJlIG9mIEFjdGl2ZSBSZWNvcmQgdG8KIyBpbmNyZW1lbnRhbGx5IG1vZGlmeSB5b3VyIGRhdGFiYXNlLCBhbmQgdGhlbiByZWdlbmVyYXRlIHRoaXMgc2NoZW1hIGRlZmluaXRpb24uCiMKIyBOb3RlIHRoYXQgdGhpcyBzY2hlbWEucmIgZGVmaW5pdGlvbiBpcyB0aGUgYXV0aG9yaXRhdGl2ZSBzb3VyY2UgZm9yIHlvdXIKIyBkYXRhYmFzZSBzY2hlbWEuIElmIHlvdSBuZWVkIHRvIGNyZWF0ZSB0aGUgYXBwbGljYXRpb24gZGF0YWJhc2Ugb24gYW5vdGhlcgojIHN5c3RlbSwgeW91IHNob3VsZCBiZSB1c2luZyBkYjpzY2hlbWE6bG9hZCwgbm90IHJ1bm5pbmcgYWxsIHRoZSBtaWdyYXRpb25zCiMgZnJvbSBzY3JhdGNoLiBUaGUgbGF0dGVyIGlzIGEgZmxhd2VkIGFuZCB1bnN1c3RhaW5hYmxlIGFwcHJvYWNoICh0aGUgbW9yZSBtaWdyYXRpb25zCiMgeW91J2xsIGFtYXNzLCB0aGUgc2xvd2VyIGl0J2xsIHJ1biBhbmQgdGhlIGdyZWF0ZXIgbGlrZWxpaG9vZCBmb3IgaXNzdWVzKS4KIwojIEl0J3Mgc3Ryb25nbHkgcmVjb21tZW5kZWQgdGhhdCB5b3UgY2hlY2sgdGhpcyBmaWxlIGludG8geW91ciB2ZXJzaW9uIGNvbnRyb2wgc3lzdGVtLgoKQWN0aXZlUmVjb3JkOjpTY2hlbWEuZGVmaW5lKHZlcnNpb246IDIwMTUwNDI4MjE0NjEwKSBkbwoKICBjcmVhdGVfdGFibGUgInN1cHBvcnRfdGlja2V0cyIsIGZvcmNlOiA6Y2FzY2FkZSBkbyB8dHwKICAgIHQuc3RyaW5nICAgImVuZHBvaW50IgogICAgdC5zdHJpbmcgICAicHJvZHVjdF9pZCIKICAgIHQuZGF0ZXRpbWUgImNyZWF0ZWRfYXQiCiAgICB0LmRhdGV0aW1lICJ1cGRhdGVkX2F0IgogIGVuZAoKZW5kCg==</textarea>
<textarea class="saurus-file" data-file="config/routes.rb" data-mode="ruby">UmFpbHMuYXBwbGljYXRpb24ucm91dGVzLmRyYXcgZG8KICAjIERlZmF1bHQgaG9tZSBwYWdlCiAgcm9vdCAncHJvZHVjdHMjbGlzdCcKCiAgIyBDcmVhdGUsIGRpc3BsYXkgYW5kIGRlbGV0ZSBzdXBwb3J0IHRpY2tldHMKICBwb3N0ICdzdXBwb3J0L2NyZWF0ZScKICBnZXQgJ3N1cHBvcnQvbGlzdCcKICBkZWxldGUgJy9zdXBwb3J0LzppZCcgPT4gJ3N1cHBvcnQjZGVzdHJveScKCiAgCiAgCgogIGdldCAnL3Byb2R1Y3RzLzppZCcsIHRvOiAncHJvZHVjdHMjc2hvdycsIGFzOiAncHJvZHVjdCcKICBwb3N0ICdjYWxsJyA9PiAndHdpbGlvI2NhbGwnCiAgcG9zdCAnY29ubmVjdCcgPT4gJ3R3aWxpbyNjb25uZWN0JwoKZW5kCg==</textarea>
<textarea class="saurus-file" data-file="app/controllers/support_controller.rb" data-mode="ruby">Y2xhc3MgU3VwcG9ydENvbnRyb2xsZXIgPCBBcHBsaWNhdGlvbkNvbnRyb2xsZXIKICBpbmNsdWRlIEdlbmVyYXRlVG9rZW4KCiAgZGVmIGNyZWF0ZQogICAgQHRpY2tldCA9IFN1cHBvcnRUaWNrZXQubmV3KHN1cHBvcnRfcGFyYW1zKQogICAgCiAgICBpZiBAdGlja2V0LnNhdmUKICAgICAgcmV0dXJuIGhlYWQoOm9rKQogICAgZWxzZQogICAgICByZXR1cm4gaGVhZCg6YmFkX3JlcXVlc3QpCiAgICBlbmQKICBlbmQKCiAgZGVmIGxpc3QKICAgIEB0b2tlbiA9IGdlbmVyYXRlX3Rva2VuICdhZ2VudCcKICAgIEB0aWNrZXRzID0gU3VwcG9ydFRpY2tldC5hbGwoKQogIGVuZAoKICAjIERFTEVURSAvYXBwb2ludG1lbnRzLzEKICAjIERFTEVURSAvYXBwb2ludG1lbnRzLzEuanNvbgogIGRlZiBkZXN0cm95CiAgICBAdGlja2V0ID0gU3VwcG9ydFRpY2tldC5maW5kKHBhcmFtc1s6aWRdKQogICAgQHRpY2tldC5kZXN0cm95CiAgICByZXR1cm4gaGVhZCg6bm9fY29udGVudCkKICBlbmQKCiAgcHJpdmF0ZQoKICAgICMgTmV2ZXIgdHJ1c3QgcGFyYW1ldGVycyBmcm9tIHRoZSBzY2FyeSBpbnRlcm5ldCwgb25seSBhbGxvdyB0aGUgd2hpdGUgbGlzdCB0aHJvdWdoLgogICAgZGVmIHN1cHBvcnRfcGFyYW1zCiAgICAgIHBhcmFtcy5wZXJtaXQoOmVuZHBvaW50LCA6cHJvZHVjdF9pZCkKICAgIGVuZAplbmQK</textarea>
<textarea class="saurus-file" data-file="app/assets/javascripts/app.js" data-mode="javascript">Ly8gU3Rhc2ggc29tZSBvYmplY3RzIGluIHRoZSBnbG9iYWwgc2NvcGUKdmFyIG15RW5kcG9pbnQsCiAgICBzdXBwb3J0Q29udmVyc2F0aW9uOwovLyBDcmVhdGUgYW4gZW5kcG9pbnQgdG8gYWRkIHRvIHRoZSBjb252ZXJzYXRpb24KZnVuY3Rpb24gY3JlYXRlRW5kcG9pbnQoKSB7CiAgICAvLyBDcmVhdGUgYSBkZWZlcnJlZCBvYmplY3QgdG8gdXNlIGpRdWVyeSBwcm9taXNlCiAgICB2YXIgZGVmZXJyZWQgPSBuZXcgJC5EZWZlcnJlZCgpOwoKICAgIG5ldyBUd2lsaW8uRW5kcG9pbnQuY3JlYXRlV2l0aFRva2VuKGNhcGFiaWxpdHlUb2tlbikudGhlbihmdW5jdGlvbihlbmRwb2ludCkgewogICAgICAgIC8vIGtlZXAgYSByZWZlcmVuY2UgZm9yIG1ha2luZyBvdXRib3VuZCBjYWxscyBsYXRlcgogICAgICAgIG15RW5kcG9pbnQgPSBlbmRwb2ludDsKCiAgICAgICAgLy8gYXV0b21hdGljYWxseSBhbnN3ZXIgYW55IGluY29taW5nIGNhbGxzCiAgICAgICAgbXlFbmRwb2ludC5vbignaW52aXRlJywgZnVuY3Rpb24oaW52aXRlKSB7CgogICAgICAgICAgICAvLyBzaG93IHRoZSB2aWRlbyBhcmVhIGFuZCBzdHJlYW1zCiAgICAgICAgICAgICQoJy52aWRlby1zdHJlYW1zJykuYWRkQ2xhc3MoJ2FjdGl2ZScpOwoKICAgICAgICAgICAgaW52aXRlLmFjY2VwdCgpLnRoZW4oZnVuY3Rpb24oY29udmVyc2F0aW9uKSB7CiAgICAgICAgICAgICAgICBzaG93VmlkZW9TdHJlYW1zKGNvbnZlcnNhdGlvbik7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIGRlZmVycmVkLnJlc29sdmUoZW5kcG9pbnQpOwoKICAgIH0sIGZ1bmN0aW9uKGVycm9yKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignQ291bGQgbm90IGNvbm5lY3QgdG8gVHdpbGlvJyk7CiAgICAgICAgY29uc29sZS5kaXIoZXJyb3IpOwogICAgfSk7CiAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZSgpOwp9CgovLyBDcmVhdGUgYSBzdXBwb3J0IHRpY2tldApmdW5jdGlvbiBjcmVhdGVUaWNrZXQoKSB7CiAgICB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKICAgICQud2hlbihjcmVhdGVFbmRwb2ludCgpKS5kb25lKGZ1bmN0aW9uKCkgewogICAgICAgIAogICAgICAgIC8vIENyZWF0ZSBhIHN1cHBvcnQgdGlja2V0CiAgICAgICAgJC5wb3N0KCcvc3VwcG9ydC9jcmVhdGUnLCB7ZW5kcG9pbnQ6IG15RW5kcG9pbnQuYWRkcmVzcywgcHJvZHVjdF9pZDogdXJsfSwgZnVuY3Rpb24oIGRhdGEgKSB7CiAgICAgICAgICAgICQoJy5zdXBwb3J0LXN0YXR1cycpLmh0bWwoJ0ZpbmRpbmcgYW4gYXZhaWxhYmxlIGFnZW50Li4uJykKICAgICAgICB9KTsKICAgIH0pCn0KCi8vIERlbGV0ZSBhIHN1cHBvcnQgdGlja2V0CmZ1bmN0aW9uIGRlbGV0ZVN1cHBvcnRUaWNrZXQodGlja2V0SWQpIHsKCiAgICBmdW5jdGlvbiByZW1vdmVUaWNrZXRSb3coKSB7CiAgICAgICAgJCgiI3RpY2tldC0iICsgdGlja2V0SWQpLnJlbW92ZSgpOwogICAgfQogICAgLy8gQ3JlYXRlIGEgc3VwcG9ydCB0aWNrZXQKICAgICQuYWpheCh7CiAgICAgICAgdHlwZTogJ0RFTEVURScsCiAgICAgICAgdXJsOiAiL3N1cHBvcnQvIiArIHRpY2tldElkLAogICAgICAgIHN1Y2Nlc3M6IHJlbW92ZVRpY2tldFJvdwogICAgfSk7Cgp9CgovLyBpbmNvbWluZyBvciBvdXRnb2luZywgZGlzcGxheSBzdHJlYW1zIG9uIHNjcmVlbgpmdW5jdGlvbiBzaG93VmlkZW9TdHJlYW1zKGNvbnZlcnNhdGlvbikgewogICAgLy8gZGVmaW5lIG91ciB2aWRlbyBjb250YWluZXJzCiAgICB2YXIgbG9jYWxWaWRlb0VsZW1lbnQgPSAkKCcjbG9jYWwtdmlkZW8nKS5nZXQoMCk7CiAgICB2YXIgcmVtb3RlVmlkZW9FbGVtZW50ID0gJCgnI3JlbW90ZS12aWRlbycpLmdldCgwKTsKCiAgICAvLyBjcmVhdGUgYSBsb2NhbFN0cmVhbSBvYmplY3QgdG8gbXV0ZSBhbmQgZW5kCiAgICBzdXBwb3J0Q29udmVyc2F0aW9uID0gY29udmVyc2F0aW9uOwoKICAgIC8vIGF0dGFjaCBvdXIgbG9jYWwgU3RyZWFtCiAgICBjb252ZXJzYXRpb24ubG9jYWxTdHJlYW0uYXR0YWNoKGxvY2FsVmlkZW9FbGVtZW50KTsKCiAgICBjb252ZXJzYXRpb24ub24oJ3BhcnRpY2lwYW50Sm9pbmVkJywgZnVuY3Rpb24ocGFydGljaXBhbnQpIHsKICAgICAgICAKICAgICAgICAvLyBhdHRhY2ggdGhlIHJlbW90ZSBTdHJlYW0KICAgICAgICBwYXJ0aWNpcGFudC5zdHJlYW0uYXR0YWNoKHJlbW90ZVZpZGVvRWxlbWVudCk7CiAgICB9KQp9OwoKZnVuY3Rpb24gY2FsbEN1c3RvbWVyKGN1c3RvbWVyRW5kcG9pbnQsIHRpY2tldElkKSB7CiAgICAkKCcudmlkZW8tc3RyZWFtcycpLmFkZENsYXNzKCdhY3RpdmUnKTsKCiAgICAvLyBVc2UgalF1ZXJ5IFByb21pc2UgdG8gY2hlY2sgd2hlbiBvdXIgZW5kcG9pbnQgaXMgY3JlYXRlZAogICAgJC53aGVuKGNyZWF0ZUVuZHBvaW50KCkpLmRvbmUoZnVuY3Rpb24oKSB7CiAgICAgICAgLy8gQ3JlYXRlIHRoZSBjb252ZXJzYXRpb24gd2l0aCB0aGUgY3VzdG9tZXJzIGVuZHBvaW50CiAgICAgICAgbXlFbmRwb2ludC5jcmVhdGVDb252ZXJzYXRpb24oY3VzdG9tZXJFbmRwb2ludCkuZG9uZShmdW5jdGlvbihjb252ZXJzYXRpb24pIHsKCiAgICAgICAgICAgIC8vIHNob3cgdGhlIHZpZGVvcwogICAgICAgICAgICBzaG93VmlkZW9TdHJlYW1zKGNvbnZlcnNhdGlvbik7CgogICAgICAgICAgICAvLyBkZWxldGUgdGhlIHN1cHBvcnQgdGlja2V0CiAgICAgICAgICAgIGRlbGV0ZVN1cHBvcnRUaWNrZXQodGlja2V0SWQpOwoKICAgICAgICB9LCBmdW5jdGlvbihlcnJvcikgewogICAgICAgICAgICBjb25zb2xlLmVycm9yKCdVbmFibGUgdG8gc2V0IHVwIGNhbGwuJyk7CiAgICAgICAgICAgIGNvbnNvbGUuZGlyKGVycm9yKTsKICAgICAgICB9KTsKICAgIH0pCn07CgovLyBNdXRlIHRoZSBsb2NhbCB2aWRlbwpmdW5jdGlvbiBtdXRlU3RyZWFtKCkgewogICAgc3VwcG9ydENvbnZlcnNhdGlvbi5sb2NhbFN0cmVhbS5tdXRlZCA9ICFzdXBwb3J0Q29udmVyc2F0aW9uLmxvY2FsU3RyZWFtLm11dGVkOwp9CgovLyBFbmQgdGhlIHZpZGVvIGNhbGwKZnVuY3Rpb24gZW5kU3RyZWFtKCkgewogICAgc3VwcG9ydENvbnZlcnNhdGlvbi5sZWF2ZSgpOwogICAgLy8gc2hvdyB0aGUgdmlkZW8gYXJlYSBhbmQgc3RyZWFtcwogICAgJCgnLnZpZGVvLXN0cmVhbXMnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7Cn0KCgokKGZ1bmN0aW9uKCkgewogICAgJCgnLnJlcXVlc3Qtc3VwcG9ydCcpLmNsaWNrKGZ1bmN0aW9uKGUpIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgY3JlYXRlVGlja2V0KCk7CiAgICB9KTsKCiAgICAkKCcuY29ubmVjdC1jYWxsJykuY2xpY2soZnVuY3Rpb24oZSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICBjdXN0b21lckVuZHBvaW50ID0gJChlLmN1cnJlbnRUYXJnZXQpLmRhdGEoJ2VuZHBvaW50Jyk7CiAgICAgICAgdGlja2V0SWQgPSAkKGUuY3VycmVudFRhcmdldCkuZGF0YSgndGlja2V0Jyk7CiAgICAgICAgY2FsbEN1c3RvbWVyKGN1c3RvbWVyRW5kcG9pbnQsIHRpY2tldElkKTsKICAgIH0pOwoKICAgICQoJy5tdXRlLXZpZGVvJykuY2xpY2soZnVuY3Rpb24oZSkgewogICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAkKCcubXV0ZS12aWRlbycpLnRvZ2dsZSgpOwogICAgICAgIG11dGVTdHJlYW0oKTsKICAgIH0pOwoKICAgICQoJy5lbmQtdmlkZW8nKS5jbGljayhmdW5jdGlvbihlKSB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIGVuZFN0cmVhbSgpOwogICAgfSk7Cn0pOw==</textarea>
<textarea class="saurus-file" data-file="app/controllers/concerns/generate_token.rb" data-mode="ruby">cmVxdWlyZSAndHdpbGlvLXJ1YnknCiMgV3JpdHRlbiBieSBDYXJ0ZXIgUmFiYXNhIC0gQENhcnRlclJhYmFzYSB0byBlYXNpbHkgcmVuZGVyIFR3aU1MIGVucG9pbnRzLgptb2R1bGUgR2VuZXJhdGVUb2tlbgogIGV4dGVuZCBBY3RpdmVTdXBwb3J0OjpDb25jZXJuCgogIGRlZiBnZW5lcmF0ZV90b2tlbihlbmRwb2ludEFkZHJlc3MpCiAgICBhY2NvdW50X3NpZCA9IEVOVlsnVFdJTElPX0FDQ09VTlRfU0lEJ10KICAgIGF1dGhfdG9rZW4gPSBFTlZbJ1RXSUxJT19BVVRIX1RPS0VOJ10KICAgIGNhcGFiaWxpdHkgPSBUd2lsaW86OlV0aWw6OkNhcGFiaWxpdHkubmV3IGFjY291bnRfc2lkLCBhdXRoX3Rva2VuCiAgICAjIGFsbG93IG91dGdvaW5nIGNhbGxzIHRvIGFuIGFwcGxpY2F0aW9uCiAgICBjYXBhYmlsaXR5LmFsbG93X2NsaWVudF9vdXRnb2luZyAnQVAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCcKICAgIGNhcGFiaWxpdHkuYWxsb3dfY2xpZW50X2luY29taW5nIGVuZHBvaW50QWRkcmVzcwogICAgQHRva2VuID0gY2FwYWJpbGl0eS5nZW5lcmF0ZQogIGVuZAoKZW5k</textarea>
<textarea class="saurus-file" data-file="app/views/layouts/application.html.erb" data-mode="html_ruby">PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KICA8aGVhZD4KICAgIDxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4KICAgIDxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iSUU9RWRnZSxjaHJvbWU9MSI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+PCU9IGNvbnRlbnRfZm9yPyg6dGl0bGUpID8geWllbGQoOnRpdGxlKSA6ICJWaWRlbyBTZXJ2aWNlIFJhaWxzIiAlPjwvdGl0bGU+CiAgICA8JT0gY3NyZl9tZXRhX3RhZ3MgJT4KICAgIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iLy9tYXhjZG4uYm9vdHN0cmFwY2RuLmNvbS9ib290c3RyYXAvMy4yLjAvY3NzL2Jvb3RzdHJhcC5taW4uY3NzIiB0eXBlPSJ0ZXh0L2NzcyI+CiAgICA8bGluayByZWw9InN0eWxlc2hlZXQiIGhyZWY9Ii8vbWF4Y2RuLmJvb3RzdHJhcGNkbi5jb20vYm9vdHN0cmFwLzMuMi4wL2Nzcy9ib290c3RyYXAtdGhlbWUubWluLmNzcyIgdHlwZT0idGV4dC9jc3MiPgoKICAgIDwlPSBzdHlsZXNoZWV0X2xpbmtfdGFnICJhcHBsaWNhdGlvbiIsIDptZWRpYSA9PiAiYWxsIiAlPgoKICAgIDwhLS0gRm9yIHRoaXJkLWdlbmVyYXRpb24gaVBhZCB3aXRoIGhpZ2gtcmVzb2x1dGlvbiBSZXRpbmEgZGlzcGxheTogLS0+CiAgICA8IS0tIFNpemUgc2hvdWxkIGJlIDE0NCB4IDE0NCBwaXhlbHMgLS0+CiAgICA8JT0gZmF2aWNvbl9saW5rX3RhZyAnYXBwbGUtdG91Y2gtaWNvbi0xNDR4MTQ0LXByZWNvbXBvc2VkLnBuZycsIDpyZWwgPT4gJ2FwcGxlLXRvdWNoLWljb24tcHJlY29tcG9zZWQnLCA6dHlwZSA9PiAnaW1hZ2UvcG5nJywgOnNpemVzID0+ICcxNDR4MTQ0JyAlPgoKICAgIDwhLS0gRm9yIGlQaG9uZSB3aXRoIGhpZ2gtcmVzb2x1dGlvbiBSZXRpbmEgZGlzcGxheTogLS0+CiAgICA8IS0tIFNpemUgc2hvdWxkIGJlIDExNCB4IDExNCBwaXhlbHMgLS0+CiAgICA8JT0gZmF2aWNvbl9saW5rX3RhZyAnYXBwbGUtdG91Y2gtaWNvbi0xMTR4MTE0LXByZWNvbXBvc2VkLnBuZycsIDpyZWwgPT4gJ2FwcGxlLXRvdWNoLWljb24tcHJlY29tcG9zZWQnLCA6dHlwZSA9PiAnaW1hZ2UvcG5nJywgOnNpemVzID0+ICcxMTR4MTE0JyAlPgoKICAgIDwhLS0gRm9yIGZpcnN0LSBhbmQgc2Vjb25kLWdlbmVyYXRpb24gaVBhZDogLS0+CiAgICA8IS0tIFNpemUgc2hvdWxkIGJlIDcyIHggNzIgcGl4ZWxzIC0tPgogICAgPCU9IGZhdmljb25fbGlua190YWcgJ2FwcGxlLXRvdWNoLWljb24tNzJ4NzItcHJlY29tcG9zZWQucG5nJywgOnJlbCA9PiAnYXBwbGUtdG91Y2gtaWNvbi1wcmVjb21wb3NlZCcsIDp0eXBlID0+ICdpbWFnZS9wbmcnLCA6c2l6ZXMgPT4gJzcyeDcyJyAlPgoKICAgIDwhLS0gRm9yIG5vbi1SZXRpbmEgaVBob25lLCBpUG9kIFRvdWNoLCBhbmQgQW5kcm9pZCAyLjErIGRldmljZXM6IC0tPgogICAgPCEtLSBTaXplIHNob3VsZCBiZSA1NyB4IDU3IHBpeGVscyAtLT4KICAgIDwlPSBmYXZpY29uX2xpbmtfdGFnICdhcHBsZS10b3VjaC1pY29uLXByZWNvbXBvc2VkLnBuZycsIDpyZWwgPT4gJ2FwcGxlLXRvdWNoLWljb24tcHJlY29tcG9zZWQnLCA6dHlwZSA9PiAnaW1hZ2UvcG5nJyAlPgoKICAgIDwhLS0gRm9yIGFsbCBvdGhlciBkZXZpY2VzIC0tPgogICAgPCEtLSBTaXplIHNob3VsZCBiZSAzMiB4IDMyIHBpeGVscyAtLT4KICAgIDwlPSBmYXZpY29uX2xpbmtfdGFnICdmYXZpY29uLmljbycsIDpyZWwgPT4gJ3Nob3J0Y3V0IGljb24nICU+CgogICAgPCU9IGphdmFzY3JpcHRfaW5jbHVkZV90YWcgImFwcGxpY2F0aW9uIiAlPgoKICAgIDwhLS0gTGUgSFRNTDUgc2hpbSwgZm9yIElFNi04IHN1cHBvcnQgb2YgSFRNTCBlbGVtZW50cyAtLT4KICAgIDwhLS1baWYgbHQgSUUgOV0+CiAgICA8c2NyaXB0IHNyYz0iLy9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvaHRtbDVzaGl2LzMuNy4yL2h0bWw1c2hpdi5taW4uanMiIHR5cGU9InRleHQvamF2YXNjcmlwdCI+PC9zY3JpcHQ+CiAgICA8IVtlbmRpZl0tLT4KICAgIDxzY3JpcHQgc3JjPSIvL21lZGlhLnR3aWxpb2Nkbi5jb20vc2RrL2NvbnZlcnNhdGlvbnMvdjAuNS9qcy9yZWxlYXNlcy8wLjUuMC5iMS1lY2FiMWJlL3R3aWxpby1jb252ZXJzYXRpb25zLmpzIj48L3NjcmlwdD4KICA8L2hlYWQ+CiAgPGJvZHk+CgogICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgICAgPCU9IHlpZWxkICU+CiAgICA8L2Rpdj4KCiAgICA8IS0tIFZpZGVvIFN1cHBvcnQgV2lkZ2V0IC0tPgogICAgPGRpdiBjbGFzcz0ic3VwcG9ydC13aWRnZXQiPgogICAgICA8JT0geWllbGQgOnByb21wdCAlPgoKICAgICAgPCEtLSBWaWRlbyBjb250YWluZXIgYW5kIGNvbnRyb2xzIC0tPgogICAgICA8ZGl2IGNsYXNzPSJ2aWRlby1zdHJlYW1zIj4KICAgICAgICA8ZGl2IGNsYXNzPSJjb250cm9scyBidG4tZ3JvdXAgYnRuLWdyb3VwLWp1c3RpZmllZCBidG4tZ3JvdXAteHMiIHJvbGU9Imdyb3VwIiBhcmlhLWxhYmVsPSIuLi4iPgogICAgICAgICAgPGEgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCBtdXRlLXZpZGVvIiBocmVmPSIjIj5NdXRlPC9hPgogICAgICAgICAgPGEgY2xhc3M9ImJ0biBidG4tZGVmYXVsdCBtdXRlLXZpZGVvIiBocmVmPSIjIiBzdHlsZT0iZGlzcGxheTpub25lIj5Vbm11dGU8L2E+CiAgICAgICAgICA8YSBjbGFzcz0iYnRuIGJ0bi1kYW5nZXIgZW5kLXZpZGVvIiBocmVmPSIjIj5FbmQgQ2FsbDwvYT4KICAgICAgICA8L2Rpdj4KICAgICAgICA8dmlkZW8gaWQ9ImxvY2FsLXZpZGVvIj48L3ZpZGVvPgogICAgICAgIDx2aWRlbyBpZD0icmVtb3RlLXZpZGVvIj48L3ZpZGVvPgogICAgICAgIAogICAgICA8L2Rpdj4KCiAgICA8L2Rpdj4KICA8L2JvZHk+CiAgPHNjcmlwdCBjaGFyc2V0PSJ1dGYtOCI+CiAgICB3aW5kb3cuY2FwYWJpbGl0eVRva2VuID0gIjwlPSBAdG9rZW4gJT4iIHx8ICIiOwogIDwvc2NyaXB0Pgo8L2h0bWw+Cg==</textarea>
</div>
</div><div class="saurus-overview"><ul></ul></div></div><div class="saurus-code"><div class="file-path"><span class="crumb-container"></span><i class="fa fa-fw fa-folder"></i></div><div class="saurus-editor"></div></div><div class="saurus-explorer"><div class="saurus-file-list"></div></div></div></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script><script src="ace/ace.js"></script><script src="ace/theme-monokai.js"></script><script src="viewsaurus.js"></script></body></html>